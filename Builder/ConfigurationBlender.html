<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Configuration Blender - Visual configuration management tool for Windows endpoints">
    <meta name="theme-color" content="#2684FF">
    <title>Configuration Blender</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Skip Link for Keyboard Users -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header - Banner Landmark -->
    <header class="header" role="banner">
        <h1>
            <span>Configuration Blender</span>
            <span id="unsavedIndicator"
                  class="unsaved-indicator"
                  role="status"
                  aria-live="polite"
                  title="You have unsaved changes">&#9679;</span>
        </h1>

        <!-- Configuration Metadata Form -->
        <form class="header-config" role="group" aria-label="Configuration metadata">
            <div class="header-config-item">
                <label for="configRole">Role</label>
                <input type="text"
                       id="configRole"
                       placeholder="US_CBL"
                       translate="no"
                       onchange="updatePreview(); markUnsaved()"
                       autocomplete="off">
            </div>
            <div class="header-config-item">
                <label for="configVersion">Version</label>
                <input type="text"
                       id="configVersion"
                       placeholder="1.0.0"
                       value="1.0.0"
                       translate="no"
                       onchange="updatePreview(); markUnsaved()"
                       autocomplete="off">
            </div>
            <div class="header-config-item">
                <label for="configDescription">Description</label>
                <input type="text"
                       id="configDescription"
                       placeholder="Configuration description"
                       onchange="updatePreview(); markUnsaved()"
                       autocomplete="off">
            </div>
            <div class="header-config-item">
                <label for="configAuthor">Author</label>
                <input type="text"
                       id="configAuthor"
                       placeholder="Your name"
                       onchange="updatePreview(); markUnsaved()"
                       autocomplete="off">
            </div>
            <div class="header-config-item">
                <label for="configDate">Date</label>
                <input type="date"
                       id="configDate"
                       onchange="updatePreview(); markUnsaved()">
            </div>
        </form>

        <!-- Action Buttons -->
        <nav class="header-buttons" role="navigation" aria-label="Main actions">
            <button type="button"
                    class="btn btn-secondary"
                    onclick="importConfig()"
                    aria-keyshortcuts="Control+O">Import</button>
            <button type="button"
                    class="btn btn-success"
                    onclick="exportConfig()"
                    aria-keyshortcuts="Control+S">Export</button>
            <button type="button"
                    class="btn btn-primary"
                    onclick="exportSummary()">Summary</button>
            <button type="button"
                    class="btn btn-info"
                    onclick="showAbout()">About</button>
            <button type="button"
                    class="btn btn-info"
                    onclick="showSettings()"
                    aria-label="Settings">&#9881;</button>
        </nav>
    </header>

    <!-- Main Content Container -->
    <main class="container" id="main-content">
        <!-- Left Panel: Checks List - Navigation Region -->
        <nav class="panel-checks" role="navigation" aria-label="Configuration checks">
            <div class="panel-header">
                <h2>Checks</h2>
                <span id="checkCount"
                      class="check-count"
                      role="status"
                      aria-live="polite"
                      aria-label="Number of checks">0</span>
            </div>

            <!-- Status and Validation Messages -->
            <div class="checks-status" role="region" aria-label="Status messages">
                <div id="statusBar"
                     class="status-bar"
                     role="status"
                     aria-live="polite"
                     aria-atomic="true"
                     style="display: none;"></div>
                <div id="dependencyWarnings"
                     role="alert"
                     aria-live="polite"></div>
            </div>

            <!-- Search -->
            <div class="checks-search">
                <label for="checksSearch" class="visually-hidden">Search checks</label>
                <input type="search"
                       id="checksSearch"
                       placeholder="Search checks..."
                       oninput="filterChecks()"
                       aria-controls="checksList">
            </div>

            <!-- Checks List -->
            <div class="checks-list"
                 id="checksList"
                 role="listbox"
                 aria-label="Configuration checks list"
                 tabindex="0">
                <div class="editor-placeholder" role="status">
                    <span>No checks added yet.</span><br>
                    <span>Click "Add Check" to begin.</span>
                </div>
            </div>

            <!-- Add Check Button -->
            <div class="panel-footer">
                <button type="button"
                        class="btn btn-primary"
                        style="width: 100%;"
                        onclick="showAddCheckModal()"
                        aria-keyshortcuts="Control+N">Add Check</button>
            </div>
        </nav>

        <!-- Middle Panel: Check Editor - Main Content Region -->
        <section class="panel-editor" role="region" aria-label="Check editor">
            <div class="panel-header">
                <h2 id="editorTitle">Check Editor</h2>
            </div>
            <div class="panel-content" id="editorContent" aria-labelledby="editorTitle">
                <div class="editor-placeholder" role="status">
                    <span>Select a check to edit, or click "Add Check" to create a new one.</span>
                </div>
            </div>
        </section>

        <!-- Right Panel: JSON Preview - Complementary Region -->
        <aside class="panel-preview" role="complementary" aria-label="JSON preview">
            <div class="panel-header">
                <h2 id="previewTitle">JSON Preview</h2>
            </div>
            <div class="panel-content">
                <pre class="json-preview"
                     id="jsonPreview"
                     role="region"
                     aria-labelledby="previewTitle"
                     aria-live="polite"
                     tabindex="0"
                     translate="no">{
  "version": "1.0.0",
  "role": "",
  "description": "",
  "author": "",
  "lastModified": "",
  "checks": []
}</pre>
            </div>
        </aside>
    </main>

    <!-- Add/Edit Check Modal Dialog -->
    <div class="modal"
         id="checkModal"
         role="dialog"
         aria-modal="true"
         aria-labelledby="checkModalTitle"
         aria-describedby="checkModalDesc">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="checkModalTitle">Add Check</h3>
                <button type="button"
                        class="close-btn"
                        onclick="closeCheckModal()"
                        aria-label="Close dialog">&times;</button>
            </div>
            <p id="checkModalDesc" class="visually-hidden">
                Configure the settings for this check type.
            </p>
            <form id="checkModalBody" onsubmit="event.preventDefault(); saveCheck();">
                <div class="form-group">
                    <label for="checkType">
                        Check Type <span class="required" aria-hidden="true">*</span>
                    </label>
                    <select id="checkType"
                            class="check-type-select"
                            onchange="showCheckProperties()"
                            required
                            aria-required="true">
                        <option value="">Select a check type...</option>
                        <optgroup label="Applications">
                            <option value="Application">Application</option>
                        </optgroup>
                        <optgroup label="Files & Folders">
                            <option value="FolderEmpty">Folder Empty</option>
                            <option value="FolderExists">Folder Exists</option>
                            <option value="FilesExist">Files Exist</option>
                            <option value="ShortcutExists">Shortcut Exists</option>
                            <option value="ShortcutsAllowList">Shortcuts Allow List</option>
                        </optgroup>
                        <optgroup label="Registry" translate="no">
                            <option value="RegistryValue">Registry Value</option>
                        </optgroup>
                        <optgroup label="Hardware & Drivers">
                            <option value="DriverInstalled">Driver Installed</option>
                            <option value="PrinterInstalled">Printer Installed</option>
                            <option value="NetworkAdapterConfiguration">Network Adapter Configuration</option>
                        </optgroup>
                        <optgroup label="System & Services">
                            <option value="ServiceRunning">Service Running</option>
                            <option value="ScheduledTaskExists">Scheduled Task Exists</option>
                            <option value="WindowsFeature">Windows Feature</option>
                            <option value="AssignedAccess">Assigned Access (Kiosk)</option>
                        </optgroup>
                        <optgroup label="Security">
                            <option value="FirewallRule">Firewall Rule</option>
                            <option value="CertificateInstalled">Certificate Installed</option>
                        </optgroup>
                    </select>
                </div>
                <div class="form-group">
                    <label for="checkName">
                        Display Name <span class="required" aria-hidden="true">*</span>
                    </label>
                    <input type="text"
                           id="checkName"
                           placeholder="e.g., Google Chrome Not Installed"
                           required
                           aria-required="true">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="checkEnabled" checked>
                        <span>Enabled</span>
                    </label>
                </div>
                <div id="checkProperties" role="group" aria-label="Check properties"></div>
                <div class="preview-actions">
                    <button type="submit" class="btn btn-success">Save Check</button>
                    <button type="button" class="btn btn-secondary" onclick="closeCheckModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- About Modal Dialog -->
    <div class="modal"
         id="aboutModal"
         role="dialog"
         aria-modal="true"
         aria-labelledby="aboutModalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="aboutModalTitle">About Configuration Blender</h3>
                <button type="button"
                        class="close-btn"
                        onclick="closeAbout()"
                        aria-label="Close dialog">&times;</button>
            </div>
            <article class="about-content">
                <h4>Named in Honor of June Blender</h4>
                <p>
                    June Blender was a Senior Content Developer at Microsoft for PowerShell. She was instrumental
                    in writing documentation and helping users understand PowerShell, including Desired State
                    Configuration (DSC). Her work made PowerShell more accessible to IT professionals and
                    developers worldwide.
                </p>
                <p>
                    This tool continues that mission - making configuration management accessible to engineers
                    regardless of their scripting expertise. By providing a visual interface to define desired
                    system states, Configuration Blender empowers teams to maintain consistent, compliant
                    workstation configurations without requiring deep PowerShell knowledge.
                </p>
                <h4>How It Works</h4>
                <ol>
                    <li><strong>Define desired state</strong> - Use this UI to create a JSON configuration file</li>
                    <li><strong>Deploy via Intune</strong> - Package the configuration as a Win32 app</li>
                    <li><strong>Monitor compliance</strong> - Proactive Remediation scripts enforce the configuration</li>
                    <li><strong>Track everything</strong> - All actions are logged for auditing and troubleshooting</li>
                </ol>
                <aside class="author-info">
                    <strong>Developed by:</strong><br>
                    <span translate="no">Joshua Walderbach</span><br>
                    Systems & Infrastructure Engineer III<br>
                    Windows Engineering OS
                </aside>
            </article>
        </div>
    </div>

    <!-- Settings Modal Dialog -->
    <div class="modal"
         id="settingsModal"
         role="dialog"
         aria-modal="true"
         aria-labelledby="settingsModalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="settingsModalTitle">Settings</h3>
                <button type="button"
                        class="close-btn"
                        onclick="closeSettings()"
                        aria-label="Close dialog">&times;</button>
            </div>
            <div id="settingsContent">
                <!-- Settings content populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Hidden File Input for Import -->
    <input type="file"
           id="fileInput"
           class="visually-hidden"
           accept=".json"
           onchange="handleFileImport(event)"
           aria-label="Import configuration file">

    <!-- Toast Container for Notifications -->
    <div id="toastContainer" class="toast-container" role="region" aria-label="Notifications" aria-live="polite"></div>

    <!-- External JavaScript files - order matters! -->
    <script src="js/accessibility.js"></script>
    <script src="js/app.js"></script>
    <script src="js/checkTypes.js"></script>
    <script src="js/validation.js"></script>
    <script src="js/export.js"></script>

    <!-- Initialize Application -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize accessibility features
            initAccessibility();
        });
    </script>
</body>
</html>
