<?xml version="1.0" encoding="utf-8"?>
<AssignedAccessConfiguration
    xmlns="http://schemas.microsoft.com/AssignedAccess/2017/config"
    xmlns:rs5="http://schemas.microsoft.com/AssignedAccess/201810/config"
    xmlns:v5="http://schemas.microsoft.com/AssignedAccess/2022/config">
    <!--
    NAMESPACE DECLARATIONS:
    - xmlns (default): Base schema from Windows 10 - required for core elements
    - xmlns:rs5: Windows 10 1809 additions - enables FileExplorerNamespaceRestrictions
                  and AutoLogonAccount DisplayName attribute
    - xmlns:v5: Windows 11 22H2 additions - enables StartPins (JSON-based Start menu)
    -->

    <!--
    ============================================================================
    PROFILES SECTION
    ============================================================================
    Profiles define WHAT the kiosk experience looks like.
    You can have multiple profiles for different user types.
    Each profile needs a unique GUID identifier.

    Generate new GUIDs with: [guid]::NewGuid() in PowerShell
    ============================================================================
    -->
    <Profiles>
        <Profile Id="{2deb1110-8a3e-4de5-a2e4-fe3d4990ef4d}">
            <!--
            ========================================================================
            ALLOWED APPLICATIONS LIST
            ========================================================================
            When Assigned Access is applied, AppLocker rules are automatically
            generated to ONLY allow these applications to run.

            App types:
            - DesktopAppPath: Win32/desktop apps (use full path or %VARIABLE%)
            - AppUserModelId: UWP/Store apps (use AUMID)

            IMPORTANT: If an app has dependencies (DLLs, child processes), those
            must also be allowed or the app may fail to launch.

            NOTE: Most Start menu pins are renamed Edge shortcuts that open web URLs.
            All three Edge entries (msedge.exe, msedge_proxy.exe, and the UWP AUMID)
            are required for these renamed web shortcuts to function properly.
            ========================================================================
            -->
            <AllAppsList>
                <AllowedApps>
                    <App DesktopAppPath="C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe" />
                    <App DesktopAppPath="C:\Program Files (x86)\Microsoft\Edge\Application\msedge_proxy.exe" />
                    <App AppUserModelId="Microsoft.MicrosoftEdge.Stable_8wekyb3d8bbwe!App" />
                    <App DesktopAppPath="C:\Program Files (x86)\Microsoft\EdgeUpdate\MicrosoftEdgeUpdate.exe" />
                    <App DesktopAppPath="C:\Windows\System32\osk.exe" />
                    <App DesktopAppPath="C:\Windows\System32\sndvol.exe" />
                    <App DesktopAppPath="%PROGRAMFILES%\MCAFEE\DLP\AGENT\FCAG.EXE" />
                    <App DesktopAppPath="%PROGRAMFILES%\WEBSENSE\WEBSENSE ENDPOINT\F1EUI.EXE" />
                    <App DesktopAppPath="C:\Walmart Applications\bginfo\bginfo.exe" />
                </AllowedApps>
            </AllAppsList>

            <!--
            ========================================================================
            FILE EXPLORER RESTRICTIONS
            ========================================================================
            By default, multi-app kiosk BLOCKS all file system browsing.
            This section explicitly allows access to specific locations.

            Options:
            - <rs5:AllowedNamespace Name="Downloads"/>  - Allow Downloads folder only
            - <v3:AllowRemovableDrives/>                - Allow USB drives
            - <v3:NoRestriction/>                       - Allow all locations (not recommended)
            - Empty or omitted                          - Block all file browsing

            Requires rs5 namespace (Windows 10 1809+)
            ========================================================================
            -->
            <rs5:FileExplorerNamespaceRestrictions>
                <rs5:AllowedNamespace Name="Downloads" />
            </rs5:FileExplorerNamespaceRestrictions>

            <!--
            ========================================================================
            START MENU PINS (Windows 11 22H2+)
            ========================================================================
            Defines which shortcuts appear pinned to the Start menu.
            Uses JSON format wrapped in CDATA (not XML like Windows 10).

            The pinnedList array contains objects specifying:
            - desktopAppLink: Path to .lnk shortcut file
            - packagedAppId: AUMID for UWP apps

            Shortcuts must exist at the specified paths or they won't appear.
            %ALLUSERSPROFILE% = C:\ProgramData (shared for all users)

            NOTE: Most of these are renamed Edge web shortcuts. The .lnk files
            point to msedge.exe with URL arguments but are renamed for usability.

            Requires v5 namespace (Windows 11 22H2+)
            ========================================================================
            -->
            <v5:StartPins>
                <![CDATA[
            { "pinnedList":[
              {"desktopAppLink":"%ALLUSERSPROFILE%\\Microsoft\\Windows\\Start Menu\\Programs\\GTA Time Clock.lnk"},
              {"desktopAppLink":"%ALLUSERSPROFILE%\\Microsoft\\Windows\\Start Menu\\Programs\\Live Better U.lnk"},
              {"desktopAppLink":"%ALLUSERSPROFILE%\\Microsoft\\Windows\\Start Menu\\Programs\\OneWalmart.lnk"},
              {"desktopAppLink":"%ALLUSERSPROFILE%\\Microsoft\\Windows\\Start Menu\\Programs\\On-Screen Keyboard.lnk"},
              {"desktopAppLink":"%ALLUSERSPROFILE%\\Microsoft\\Windows\\Start Menu\\Programs\\Time Adjustment.lnk"},
              {"desktopAppLink":"%ALLUSERSPROFILE%\\Microsoft\\Windows\\Start Menu\\Programs\\Two-Step Verification.lnk"},
              {"desktopAppLink":"%ALLUSERSPROFILE%\\Microsoft\\Windows\\Start Menu\\Programs\\ULearn.lnk"},
              {"desktopAppLink":"%ALLUSERSPROFILE%\\Microsoft\\Windows\\Start Menu\\Programs\\Volume.lnk"},
              {"desktopAppLink":"%ALLUSERSPROFILE%\\Microsoft\\Windows\\Start Menu\\Programs\\Walmart Academy.lnk"},
              {"desktopAppLink":"%ALLUSERSPROFILE%\\Microsoft\\Windows\\Start Menu\\Programs\\Walmart Careers.lnk"}
            ] }
          ]]>
            </v5:StartPins>

            <!--
            ========================================================================
            TASKBAR CONFIGURATION
            ========================================================================
            ShowTaskbar: true/false
            - true:  Taskbar is visible (users can see clock, system tray, etc.)
            - false: Taskbar is permanently hidden (not just auto-hide)

            Note: You cannot customize which apps are pinned to the taskbar in
            multi-app kiosk mode.
            ========================================================================
            -->
            <Taskbar ShowTaskbar="true" />
        </Profile>
    </Profiles>

    <!--
    ============================================================================
    CONFIGS SECTION
    ============================================================================
    Configs define WHO gets the kiosk experience.
    Links user accounts or groups to the profiles defined above.

    Account types supported:
    - <Account>username</Account>                      - Specific local/domain/AAD user
    - <AutoLogonAccount/>                              - Windows creates and manages account
    - <UserGroup Type="LocalGroup"/>                   - Local security group
    - <UserGroup Type="ActiveDirectoryGroup"/>         - AD security group
    - <UserGroup Type="AzureActiveDirectoryGroup"/>    - AAD/Entra group
    ============================================================================
    -->
    <Configs>
        <Config>
            <!--
            ========================================================================
            AUTO LOGON ACCOUNT
            ========================================================================
            AutoLogonAccount tells Windows to:
            1. Automatically create a local user account for kiosk mode
            2. Configure that account to auto-login after every reboot
            3. Apply the specified profile to that account

            This eliminates the need to:
            - Pre-create a "kioskuser0" account in your image
            - Manage credentials or passwords
            - Handle race conditions where the account doesn't exist yet

            The rs5:DisplayName attribute sets what appears on the login screen.

            Requires rs5 namespace for DisplayName attribute.
            ========================================================================
            -->
            <AutoLogonAccount rs5:DisplayName="US CBL Kiosk" />
            <DefaultProfile Id="{2deb1110-8a3e-4de5-a2e4-fe3d4990ef4d}" />
        </Config>
    </Configs>
</AssignedAccessConfiguration>
